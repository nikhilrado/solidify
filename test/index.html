<script src="/ex-scripts/three.min.js"></script>
<script src="/ex-scripts/STLLoader.js"></script>
<script src="/ex-scripts/OrbitControls.js"></script>
<input></input>
<div id="model" style="width: 100vw; height: 100vh"> </div>

<script>
function STLViewer(model, elementID) {
  var elem = document.getElementById(elementID);
  camera = new THREE.PerspectiveCamera(
    70, elem.clientWidth / elem.clientHeight,1,1000);
  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(elem.clientWidth, elem.clientHeight);
  elem.appendChild(renderer.domElement);
  window.addEventListener(
    "resize",
    function () {
      renderer.setSize(elem.clientWidth, elem.clientHeight);
      camera.aspect = elem.clientWidth / elem.clientHeight;
      camera.updateProjectionMatrix();
    },
    false
  );

  //controls
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.rotateSpeed = 0.05;
  controls.dampingFactor = 1.2;
  controls.enableZoom = true;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.75;

  scene = new THREE.Scene();
  scene.add(new THREE.HemisphereLight(0xffffff, 1.5));
	const light = new THREE.PointLight( 0xffffff, 1, 100 );
	light.position.set( 50, -50, 50 );
	scene.add(light);

  loadit(model);
}

function loadit(model){
  new THREE.STLLoader().load(model, function (geometry) {
    var material = new THREE.MeshPhongMaterial({
      color: 0xff5533,
      specular: 100,
      shininess: 100,
    });
    mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    console.log(mesh);
    //scene.remove(mesh);

    var middle = new THREE.Vector3();
    geometry.computeBoundingBox();
    geometry.boundingBox.getCenter(middle);
    mesh.geometry.applyMatrix4(
      new THREE.Matrix4().makeTranslation(-middle.x, -middle.y, -middle.z)
    );

    var largestDimension = Math.max(
      geometry.boundingBox.max.x,
      geometry.boundingBox.max.y,
      geometry.boundingBox.max.z
    );
    camera.position.z = largestDimension * 1.5;

    var animate = function () {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    };

    animate();
  });
}


</script>

<script type="text/javascript">
		var URL = 'https://4befauqm4ynfn7ryg7huizv6ca0lcoxq.lambda-url.us-east-2.on.aws?csv='
	
	function load_stl(csv){
    fetch(URL+'['+csv+']')
    .then(function (u) {return u.json();})
    .then(function (json) {
		console.log(json);
		//loadit(json);
    STLViewer(json, "model"); // calling and passing json to another function processPriceInfo
    });
	}
	var data = prompt("enter some data")
	console.log(data);
	load_stl(data)
	//load_stl([2,3,1,3,4,2,5,2,3,.5,2])
	
window.onload = function() {
    //STLViewer("https://3ddata.nikhilrado.repl.co/ex-scripts/will-ronan.stl", "model")
}
</script>